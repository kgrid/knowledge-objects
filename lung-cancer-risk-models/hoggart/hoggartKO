{
    "metadata": {
        "title": "Hoggart, A Risk Model for Lung Cancer Incidence ",
        "description": "This knowledge object takes in an individuals smoker status, smoking duration, age and covariates to calculate the individuals probability of being diagnosed with lung cancer in 1 year from age t. This model was created within a collection of lung cancer models including Spitz Model, Tammemagi Model, Park Model, Liverpool Model, Etzel Model, Cassidy Model, and Bach Model.",
        "citations": [
            {
                "title": null,
                "at": null
            }
        ]
    },
    "inputMessage": "<rdf:RDF xmlns:ot=\"http://uofm.org/objectteller/#\"\n         xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">\n    <rdf:Description rdf:about=\"http://uofm.org/objectteller/inputMessage\">\n        <ot:noofparams>4</ot:noofparams>\n        <ot:params>\n            <rdf:Seq>\n                <rdf:li>smokerStatus</rdf:li>\n                <rdf:li>smokDurat</rdf:li>\n                <rdf:li>t</rdf:li>\n                <rdf:li>riskFactors</rdf:li>\n            </rdf:Seq>\n        </ot:params>\n    </rdf:Description>\n    <rdf:Description rdf:about=\"http://uofm.org/objectteller/smokerStatus/\">\n        <ot:datatype>STRING</ot:datatype>\n    </rdf:Description>\n    <rdf:Description rdf:about=\"http://uofm.org/objectteller/smokDurat/\">\n        <ot:datatype>FLOAT</ot:datatype>\n    </rdf:Description>\n    <rdf:Description rdf:about=\"http://uofm.org/objectteller/t/\">\n        <ot:datatype>INT</ot:datatype>\n    </rdf:Description>\n    <rdf:Description rdf:about=\"http://uofm.org/objectteller/covariates/\">\n        <ot:datatype>MAP</ot:datatype>\n    </rdf:Description>\n</rdf:RDF>\n",
    "outputMessage": "<rdf:RDF xmlns:ot=\"http://uofm.org/objectteller/\"\n  xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">\n  <rdf:Description rdf:about=\"http://uofm.org/objectteller/outputMessage\">\n    <ot:returntype>MAP</ot:returntype>\n  </rdf:Description>\n</rdf:RDF>\n",
    "payload": {
        "content": "# Hoggart, A Risk Model for Lung Cancer Incidence (Hoggart, et al, 2012)\n# Created by: Kristen McGarry, KGrid\n# Last updated: May 4th, 2017\n\nimport math\nfrom math import exp\n# **** TIME ZERO IS SET TO 35 YEARS OLD ****\ndef execute(inputs):\n    smokerStatus = inputs[\"smokerStatus\"]\n    smokDurat = inputs[\"smokDurat\"]\n    riskFactors = inputs[\"riskFactors\"]\n    t = inputs[\"t\"]\n\n    survFuncCan = (calcSurvFunc(smokerStatus,\"cancer\",smokDurat,t))\n    exp_betaXCan = betaX(smokerStatus,riskFactors)\n    P_Cancer = (1-exp(exp_betaXCan*survFuncCan))\n\n    survFuncDea = (calcSurvFunc(smokerStatus,\"death\",smokDurat,t))\n    exp_betaXDea = betaX(smokerStatus,riskFactors)\n    P_Death = (exp(exp_betaXCan*survFuncCan))\n\n    P_diagnosis = round((P_Cancer * P_Death)*100,2)\n\n    interpretation = \"This individual has a \" + str(P_diagnosis) + \"% probability of being diagnosed with lung cancer in 1 year from age t.\"\n    return {\"result\":P_diagnosis,\"interpretation\":interpretation}\n\n\ndef betaX(smokerStatus,riskFactors):\n    # sex: female = 1, male =0, Hazard Rations, Table 3\n    HR_current = {\"sex\":1.35,\"bmi\":0.963,\"edLevel\":0.944,\"hayFever\":0.593,\"asthma\":0.85,\"famHxCanc\":1.27,\"chr15q25\":1.13,\"chr5p15\":0.954,\"silica\":0.893,\"pah\":0.988,\"metal\":0.961,\"asbestos\":0.943}\n    HR_former = {\"sex\":1.2,\"bmi\":0.96,\"edLevel\":0.436,\"hayFever\":0.901,\"asthma\":1.58,\"famHxCanc\":1.23,\"chr15q25\":1.14,\"chr5p15\":1.06,\"silica\":0.851,\"pah\":0.869,\"metal\":1.23,\"asbestos\":1.05}\n\n    total = 0\n\n    for covariate in riskFactors.keys():\n        if smokerStatus == \"current\":\n            HR_map = HR_current\n        elif smokerStatus == \"former\":\n            HR_map = HR_former\n        HR = HR_map[covariate]\n        beta = math.log(HR,10)\n\n        x = riskFactors[covariate]\n        if x == \"female\":\n            x = 1\n\n\n        if (x == 0) or (x==\"male\"):\n            continue\n        else:\n            total= total + (beta*x)\n\n    return (exp(total))\n\ndef calcSurvFunc(smokerStatus,survivorStatus,smokDurat,t):\n    # Weibull hazard parameters, Table 2\n    ref ={\"current\":\n        {\"cancer\":\n            {\"lam\":[3.819,4.056,4.23,4.339,4.38,4.567,4.506,4.504],\n            \"gamma\":[0.999,1.071,1.298,1.518,1.679,1.517,1.615,1.684]},\n        \"death\":\n            {\"lam\":[3.69,3.774,3.859,3.944,3.979,4.049,4.096,4.069],\n            \"gamma\":[1.22,1.312,1.560,1.775,1.925,1.854,1.838,1.912]}},\n    \"former\":\n        {\"cancer\":\n            {\"lam\":[4.987,4.723,4.321,5.179,4.786,4.651,4.654,4.366,5.563,4.68,4.491,4.241,4.177],\n            \"gamma\":[0.75,0.819,1.032,1.165,1.353,1.46,1.318,1.662,1.088,1.705,1.879,2.336,2.574]},\n        \"death\":\n            {\"lam\":[3.754,3.75,3.8,4.008,3.975,3.954,3.928,3.982,4.123,4.058,4.02,3.999,4.041],\n            \"gamma\":[1.21,1.511,1.669,1.621,1.742,1.835,2.129,2.15,1.769,1.865,2.148,2.36,2.49]}}}\n\n    s = smokDurat\n\n    lam = 0\n    gamma = 0\n\n    if smokerStatus == \"current\":\n        if (t <= 18):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][0]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][0]\n        elif ((t > 18) and (t <=20)):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][1]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][1]\n        elif ((t > 20) and (t <=22)):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][2]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][2]\n        elif ((t > 22) and (t <=24)):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][3]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][3]\n        elif ((t > 24) and (t <=26)):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][4]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][4]\n        elif ((t > 26) and (t <=28)):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][5]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][5]\n        elif ((t > 28) and (t <=30)):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][6]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][6]\n        elif (t > 30):\n            lam = ref[smokerStatus][survivorStatus][\"lam\"][7]\n            gamma = ref[smokerStatus][survivorStatus][\"gamma\"][7]\n\n    elif smokerStatus == \"former\":\n        if (t <= 22):\n            if (s<= 20):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][0]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][0]\n            if ((s>=30) and (s >20)):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][1]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][1]\n            if (s>30):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][2]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][2]\n        if (t <= 26) and (t >22):\n            if (s<= 20):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][3]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][3]\n            if ((s<=30) and (s >20)):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][4]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][4]\n            if ((s>30) and (s <= 36)):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][5]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][5]\n            if ((s>36) and (s <= 42)):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][6]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][6]\n            if (s>42):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][7]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][7]\n        if (t >26):\n            if (s<= 20):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][8]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][8]\n            if ((s<=30) and (s >20)):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][9]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][9]\n            if ((s>30) and (s <= 36)):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][10]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][10]\n            if ((s>36) and (s <= 42)):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][11]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][11]\n            if (s>42):\n                lam = ref[smokerStatus][survivorStatus][\"lam\"][12]\n                gamma = ref[smokerStatus][survivorStatus][\"gamma\"][12]\n\n    temp = (((t/lam)**gamma) - (((t+1)/lam)**gamma))\n    return temp\n\n\ndef test():\n    if str(calcSurvFunc(\"former\",\"death\",40,48)) != \"-17.5759666625\":\n        return \"error.\"\n    if execute({\"smokerStatus\":\"former\",\"smokDurat\":10,\"t\":24,\"riskFactors\":{\"sex\":\"female\",\"bmi\":28,\"hayFever\": 1}}) != {'interpretation': 'This individual has a 13.93% probability of being diagnosed with lung cancer in 1 year from age t.', 'result': 13.93}:\n        return \"error.\"\n    if execute({\"smokerStatus\":\"current\",\"smokDurat\":10,\"t\":10,\"riskFactors\":{\"sex\":\"male\",\"bmi\":34,\"asbestos\": 1}}) != {'interpretation': 'This individual has a 11.74% probability of being diagnosed with lung cancer in 1 year from age t.', 'result': 11.74}:\n        return \"error.\"\n    if execute({\"smokerStatus\":\"current\",\"smokDurat\":15,\"t\":30,\"riskFactors\":{\"sex\":\"male\",\"bmi\":38,\"asbestos\": 0,\"famHxCanc\": 1,\"asthma\":0}}) != {'interpretation': 'This individual has a 25.0% probability of being diagnosed with lung cancer in 1 year from age t.', 'result': 25.0}:\n        return \"error.\"\n    if execute({\"smokerStatus\":\"current\",\"smokDurat\":15,\"t\":30,\"riskFactors\":{\"sex\":\"male\",\"bmi\":38,\"asbestos\": 1,\"famHxCanc\": 1,\"asthma\":0}}) != {'interpretation': 'This individual has a 24.99% probability of being diagnosed with lung cancer in 1 year from age t.', 'result': 24.99}:\n        return \"error.\"\n    return \"ok.\"\n",
        "engineType": "Python",
        "functionName": "execute"
    },
    "url": "https://dlhs-fedora-dev.med.umich.edu/ObjectTeller/knowledgeObject/ark:/99999/fk45430b5m",
    "source": "user-generated"
}
